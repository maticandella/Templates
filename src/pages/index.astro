---
import Layout from '../layouts/Layout.astro';
import data from '../data/event.json';
import Hero from '../components/Hero.astro';
import Countdown from '../components/Countdown.astro';
import Carousel from '../components/Carousel.astro';
import Cards from '../components/Cards.astro';
import Gifts from '../components/Gifts.astro';
import SocialMedia from '../components/SocialMedia.astro';
import 'remixicon/fonts/remixicon.css';
import Footer from '../components/Footer.astro';
import Modal from '../components/Modal.astro';
import Fest from '../components/Fest.astro';
import Video from '../components/Video.astro';
import Subtitle from '../components/Subtitle.astro';
---

<button id="music-control" class="fixed top-10 right-10 bg-slate-300 text-black rounded-full p-4 shadow-md transition duration-300 flex justify-center items-center">
  <img src="images/play.png" class="w-6 h-6 object-cover" alt="Icono de play">
</button>

<audio id="background-music" src="music.mp3" loop></audio>

<Layout titletop={data.titletop}>
	<!-- todo ver ubicacion de elementos en base a la foto de flor -->
	<Hero />

	<!-- todo agrandar comillas en pantallas de celu -->
	<!-- todo cambiar frase -->
	<section class="px-4 overflow-x-auto my-10">
		<Subtitle />
	</section>

	<!-- todo cambiar tipofrafía -->
	<section class="relative flex flex-col justify-center items-center space-y-4 my-10 text-white min-h-[500px] w-full">
		
		<!-- Fondo -->
		<div class="absolute inset-0 bg-[url('/images/disco.webp')] bg-cover bg-center grayscale brightness-50" data-background></div>
		
		<!-- Centro oscuro -->
		<div class="absolute inset-0 z-0 flex items-center justify-center pointer-events-none">
			<div class="w-[60%] h-[60%] bg-black/60 rounded-full blur-3xl"></div>
		</div>

		<!-- Contador de tiempo faltante para la fiesta -->
		<div class="relative z-10 text-center flex flex-col gap-6">
			<Countdown />
		</div>
		 
	</section>

	<!-- Sección fiesta -->
	<section class="relative">
		<Fest />
	</section>
	
	<!-- Sección Galería -->
	<section class="my-10">
		<Carousel />
	</section>
	
	
	<!-- Sección Cards -->
	<section class="my-10">
		<Cards />
	</section>

	<!-- Sección Gifts -->
	<section class="relative my-10">
		<Gifts />
	</section>

	<!-- Sección Social Media -->
	<section class="my-10">
		<SocialMedia />
	</section>

	<section class="relative w-full h-[80vh] flex items-center justify-center overflow-hidden text-white">
		<Video />
	</section>
	
	<Footer />
</Layout>

<script>
  const sectionsWithBackground = document.querySelectorAll('section[data-background]');
  const musicControl = document.getElementById('music-control');
  const audio = document.getElementById('background-music');

  let isPlaying = false;

  // === Lógica para reproducir/pausar ===
  if (musicControl && audio instanceof HTMLAudioElement) {
    musicControl.addEventListener('click', () => {
      if (!isPlaying) {
        audio.play();
        musicControl.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
            <path d="M12 1C5.925 1 1 5.925 1 12s4.925 11 11 11 11-4.925 11-11S18.075 1 12 1zM12 19C6.477 19 2 14.523 2 9S6.477 1 12 1s10 5.477 10 10-5.477 10-10 10z" />
          </svg>
        `;
        isPlaying = true;
      } else {
        audio.pause();
        musicControl.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
            <path d="M12 1C5.925 1 1 5.925 1 12s4.925 11 11 11 11-4.925 11-11S18.075 1 12 1zM12 19C6.477 19 2 14.523 2 9S6.477 1 12 1s10 5.477 10 10-5.477 10-10 10z" />
          </svg>
        `;
        isPlaying = false;
      }
    });
  }

  // === Lógica para ajustar z-index ===
  window.addEventListener('scroll', () => {
    let isInSectionWithBackground = false;

    sectionsWithBackground.forEach(section => {
      const rect = section.getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom > 0) {
        isInSectionWithBackground = true;
      }
    });

    if (musicControl) {
      musicControl.style.zIndex = isInSectionWithBackground ? '1000' : '10';
    }
  });
</script>